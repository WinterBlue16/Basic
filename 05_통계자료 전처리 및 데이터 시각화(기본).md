# 서울시 범죄현황 통계자료 분석 & 시각화

> 서울시 관서별 5대 범죄 발생 & 검거 현황 데이터를 활용, `python` 언어로 데이터 분석 및 전처리하여 시각화까지 진행. 

```python
# 필요 라이브러리 불러오기

import numpy as np 
import pandas as pd
import seaborn as sns

import matplotlib.pyplot as plt # 시각화
from matplotlib import font_manager, rc # rc==run configuration, 한글 폰트를 잡아줌
```



## 1. 데이터 분석 및 전처리

> 데이터를 분석하여 필요한 열들을 새로 만들고, 쓸모없어진 열들을 제거하여 데이터를 전처리한다. 

```python
# 데이터 불러오기(해당 데이터가 python 작업 파일이 있는 파일 내에 존재해야 한다!)

df = pd.read_excel('관서별 5대범죄 발생 및 검거.xlsx', encoding='utf-8') 
# 엑셀 파일을 불러오는 함수

# 데이터 형태 둘러보기

df.head() # head 함수 외 tail, describe, info 함수 등도 활용 가능
```



### 1.1 경찰서 구별로 정리

```python
 # 서울시 경찰청의 소속 구 http://goo.gl/MQSqXX
 
 police_to_gu = {'서대문서': '서대문구', '수서서': '강남구', '강서서': '강서구', '서초서': '서초구','서부서': '은평구', '중부서': '중구', '종로서': '종로구', '남대문서': '중구', '혜화서': '종로구', '용산서': '용산구', '성북서': '성북구', '동대문서': '동대문구',
'마포서': '마포구', '영등포서': '영등포구', '성동서': '성동구', '동작서': '동작구', '광진서': '광진구', '강북서': '강북구', '금천서': '금천구', '중랑서': '중랑구', '강남서': '강남구', '관악서': '관악구', '강동서': '강동구', '종암서': '성북구', '구로서': '구로구', '양천서': '양천구', '송파서': '송파구', '노원서': '노원구', '방배서': '서초구', '은평서': '은평구', '도봉서': '도봉구'}

    
# 관서명에 따른 소속 구 열 추가

df['구별'] = df['관서명'].apply(lambda x : police_to_gu(x, '구 없음'))
# '관서명' 열에 lambda 함수를 적용하고, value가 존재하지 않을 경우 '구 없음' 출력해 열에 채움
# 틈틈이 df.head()로 데이터 형태 확인


# index 열 변경(관서별 -> 구별, column 오름차순 정렬)

gu_df = pd.pivot_table(df, index='구별', aggfunc=np.sum) # 소속 구가 같을 경우 수치합산

# 필요없는 행 삭제

gu_df = gu_df.drop(['구 없음'])
```



### 1.2 범죄별 범죄율 계산 

```python 
# 범죄별 검거율(검거율/발생률) 데이터 계산, column 추가

gu_df['강간범죄율'] = gu_df['강간(검거)']/gu_df['강간(발생)']*100
gu_df['강도검거율'] = gu_df['강도(검거)']/gu_df['강도(발생)']*100
gu_df['살인검거율'] = gu_df['살인(검거)']/gu_df['살인(발생)']*100
gu_df['절도검거율'] = gu_df['절도(검거)']/gu_df['절도(발생)']*100
gu_df['폭력검거율'] = gu_df['폭력(검거)']/gu_df['폭력(발생)']*100
gu_df['검거율'] = gu_df['소계(검거)']/gu_df['소계(발생)']*100


# 필요없는 column 삭제 

del gu_df['강간(검거)']
del gu_df['강도(검거)']
del gu_df['살인(검거)']
del gu_df['소계(검거)']
del gu_df['절도(검거)']
del gu_df['소계(검거)']

# 수치 조절 1

columns = ['강간검거율', '강도검거율', '살인검거율', '절도검거율', '폭력검거율']
gu_df_rate = gu_df[columns]

for row_index, row in gu_df_rate.iterrows():
    for column in columns:
        if row[column] > 100:
            gu_df.at[row_index, column] = 100

# 수치 조절 2
            
gu_df[gu_df[['강간검거율', '강도검거율', '살인검거율', '절도검거율', '폭력검거율']] >100] = 100

            
# 확인 

gu_df[['강간검거율', '강도검거율', '살인검거율', '절도검거율', '폭력검거율']] > 100
```

```python
# 새롭게 column 이름 바꿔주기

gu_df.rename(columns = {'강간(발생)':'강간',
                       '강도(발생)':'강도',
                       '살인(발생)':'살인',
                       '절도(발생)':'절도',
                       '폭력(발생)':'폭력'}, inplace=True) # 덮어쓰기를 위해 True 값 지정
```



### 1.3 인구데이터 merge 

> 인구 데이터를 불러와 기존 데이터와 합친다.

```python
# 인구 데이터 불러오기(index 구별로 지정)

popul_df = pd.read_csv('pop_kr.csv', encoding='utf-8', index_col='구별')
# popul_df = pd.read_csv('pop_kr.csv', 'encoding=utf-8').set_index('구별')도 ok

# 데이터 프레임 합치기(두 프레임의 index가 같아야 한다!)1

gu_df = gu_df.join(popul_df)

# 데이터 프레임 합치기 2(하단 image 참고)

gu_df = pd.merge(gu_df, popul_df, how='outer', left_index=True, right_index=True)
```

![](https://miro.medium.com/max/2048/1*0kmbh78B0odSxJEkjYa1lQ.png)



## 2. 데이터 살피기

> 시각화를 통해 보다 데이터를 정밀하게 분석할 수 있도록 데이터를 수정해 준다.

```python
# '검거율' 수치 기준으로 내림차순 정렬 

gu_df.sort_values(by='검거율', ascending=False, inplace=True)

# heatmap으로 데이터 중간점검하기

import seaborn as sns
sns.heatmap(gu_df[['강간', '강도', '살인', '절도', '폭력']])
```



### 2.1 범죄별 발생 건수 정규화하기

> 범죄별 가장 많이 사건이 발생한 구를 1(==100%)로 생각한다.

```python
# 각 column별 평균값 확인

gu_df.mean()

# 5대 범죄 column 값들을 해당 범죄별 최댓값으로 나눠줌

weight_col = gu_df[['강간', '강도', '살인', '절도', '폭력']].max # column 별 최댓값
crime_count_norm = gu_df[['강간', '강도', '살인', '절도', '폭력']] / weight_col
# 각 column 수치를 전부 최댓값으로 나눠주기 => scale 조정 완료
```



### 2. 2 한글 데이터 시각화 준비

```python
# 시각화 라이브러리 가져오기

from matplotlib import font_manager, rc
%matplotlib inline

# matplotlib에서 한글 표기 깨지지 않도록 하기 + 폰트 불러오기

font_name = font_manager.FontProperties(fname='c:/Windows/Fonts/malgun.ttf').get_name()
rc('font', family=font_name)
```



### 2.3 구별 강간 발생 순위 보기

```
# seaborn의 heatmap으로 시각화(내림차순 정렬)

sns.heatmap(crime_count_norm.sort_values(by='강간', ascending=False))

# 정밀한 시각화

plt.figure(figsize = (10, 10))
sns.heatmap(crime_count_norm.sort_values())
```



