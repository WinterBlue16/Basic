# ì›¹ ì„œë¹„ìŠ¤ ë°°í¬ í…ŒìŠ¤íŠ¸ ë¡œê·¸

í•´ë‹¹ ë¬¸ì„œëŠ” AWS EC2ë¥¼ ì´ìš©í•œ ì›¹ ì„œë¹„ìŠ¤ ë°°í¬ ê³¼ì •ì„ ê¸°ë¡í•œ ë¬¸ì„œì´ë‹¤. ë°°í¬ ê³¼ì •ì€ [ë„¤ë¡œì˜ ë‹¤ë½ë°©-Django ì„œë¹„ìŠ¤ AWSë¡œ ë°°í¬í•˜ê¸°](https://nerogarret.tistory.com/45)ë¥¼ ì£¼ë¡œ ì°¸ê³ í•˜ì˜€ìœ¼ë©°, [ì´ê³³](https://ssungkang.tistory.com/entry/django-AWS-EC2%EB%A1%9C-%EB%B0%B0%ED%8F%AC)ë„ ì°¸ê³ í•˜ì˜€ë‹¤. 



## 1. ë°‘ì¤€ë¹„

AWS EC2ë¡œ í”„ë¡œì íŠ¸ ë°°í¬ë¥¼ í•˜ê¸° ìœ„í•œ ë°‘ì‘ì—…ì´ë‹¤. AWS ê³„ì •ì„ ë§Œë“¤ê³ , í”„ë¡œì íŠ¸ í´ë”ì™€ gitì„ ì—°ë™í•œë‹¤. 

### 1.1. AWS ê³„ì • ë§Œë“¤ê¸°

ê°€ì… ì‹œ ê¸°ë³¸ì ìœ¼ë¡œ ë£¨íŠ¸ ì‚¬ìš©ìë¡œ ë¡œê·¸ì¸ëœë‹¤. í•˜ì§€ë§Œ ë³´ì•ˆì„ ìœ„í•´ì„œëŠ” IAM ì‚¬ìš©ì ê³„ì •ì„ ë§Œë“¤ì–´ ê°€ì… ì‹œì— ì‚¬ìš©í•˜ë©´ ì¢‹ë‹¤. IAM ì‚¬ìš©ì ê³„ì • ìƒì„± ë° ë¡œê·¸ì¸ì€ [ì—¬ê¸°]()ë¥¼ ì°¸ê³ í•˜ì˜€ë‹¤. 



### 1.2. í”„ë¡œì íŠ¸ í´ë”ì™€ git ì—°ë™í•˜ê¸°

git bashë¥¼ í™œìš©í•˜ì—¬ ë¡œì»¬ ì»´í“¨í„°ì— ì €ì¥ë˜ì–´ ìˆëŠ” í”„ë¡œì íŠ¸ í´ë”ë¥¼ ì°¾ê³ , githubì˜ ì €ì¥ì†Œì™€ ì—°ë™ì‹œí‚¨ë‹¤. ì´ ë•Œ ë¯¸ë¦¬ ë³¸ì¸ì˜ githubì— ì›¹ ì„œë¹„ìŠ¤ ê´€ë¦¬ë¥¼ ìœ„í•œ ìƒˆ ì €ì¥ì†Œë¥¼ ìƒì„±í•´ ë‘ì–´ì•¼ í•œë‹¤. 

ìƒˆë¡œìš´ ì €ì¥ì†Œê°€ ì•„ë‹ˆê±°ë‚˜, ìƒˆ ì €ì¥ì†Œë¼ê³  í•´ë„ ì´ë¯¸ git cloneì„ ë‹¤ë¥¸ ê³³ì— í•´ë‘ì—ˆê±°ë‚˜ ë‹¤ë¥¸ íŒŒì¼ë“¤ì„ ì»¤ë°‹í•œ ì ì´ ìˆë‹¤ë©´ fatalì´ ë°œìƒí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ê¹¨ë—í•œ ì±„ë¡œ ë†”ë‘ë„ë¡ í•˜ì. 

```shell
# ëª…ë ¹ì–´ ì‹¤í–‰ ìœ„ì¹˜
$ ls # ì•„ë˜ì™€ ê°™ì€ íŒŒì¼ë“¤ì´ ë‚˜ì™€ì•¼ í•œë‹¤
â”œâ”€â”€ ğŸ“‚ postype_search
â”œâ”€â”€ ğŸ“‚ cp_search
â”œâ”€â”€ ğŸ“„ db.sqlite3
â”œâ”€â”€ ğŸ“„ manage.py
â””â”€â”€ ğŸ“„ requirements.txt
```

í•´ë‹¹ ìœ„ì¹˜ì—ì„œ ì•„ë˜ì˜ ì½”ë“œë¥¼ ë”°ë¥¸ë‹¤.

```shell
$ git init
$ git add .
$ git remote add origin ì €ì¥ì†Œ ì£¼ì†Œ
$ git commit -m "ì»¤ë°‹ ë©”ì‹œì§€"
$ git push origin master
```

ì´í›„ íŒŒì¼ì„ ìˆ˜ì •í•˜ê±°ë‚˜ ì €ì¥ì†Œ ë‚´ì— ë³€ë™ ì‚¬í•­ì´ ìˆì„ ë•Œë§ˆë‹¤ ë°”ë¡œ ë°˜ì˜í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤. 

```shell
# ë§Œë“¤ì–´ë‘ì§€ ì•Šì•˜ë‹¤ë©´ ë¯¸ë¦¬ ë§Œë“¤ì–´ë‘˜ ê²ƒ
$ pip3 freeze >> requirements.txt
```

ì›ê²© ì„œë²„ì— ì ‘ì†í•´ ê¸°ë³¸ ì„¸íŒ…ì„ í•  ë•Œ í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ë¥¼ í¸ë¦¬í•˜ê²Œ í•˜ê¸° ìœ„í•œ ê²ƒì´ë‹¤. í•˜ì§€ë§Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë²„ì „ì´ ë§ì§€ ì•Šì•„ ì„œë²„ì—ì„œ íŠ•ê¸°ëŠ” ê²½ìš°ë„ ì ì§€ ì•Šìœ¼ë¯€ë¡œ í° ì†Œìš©ì€ ì—†ì„ ìˆ˜ë„ ìˆë‹¤. 



## 2. runserver ì‹¤í–‰í•˜ê¸°

EC2 í”„ë¦¬ í‹°ì–´ë¥¼ í™œìš©í•˜ì—¬ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê¸°ë³¸ ì„¤ì •ì„ ì…ë ¥í•˜ê³ , í”„ë¡œì íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ ì›ê²© ì„œë²„ í™˜ê²½ì„ ì„¸íŒ…í•œë‹¤. 

### 2.1. EC2ì—ì„œ ì¸ìŠ¤í„´ìŠ¤ ì‹œì‘í•˜ê¸°

í”„ë¦¬ í‹°ì–´ëŠ” ì‚¬ìš©ëŸ‰ì´ë‚˜ ì„œë²„ ì„ íƒì— ìˆì–´ ì œí•œì´ ì¡´ì¬í•œë‹¤. ì›ê²© ì„œë²„ë¡œëŠ” ubuntu 18.04ë¥¼ ì„ íƒí•˜ì˜€ë‹¤. ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì‹œ **í‚¤ í˜ì–´ íŒŒì¼ì„ ë°˜ë“œì‹œ ë‹¤ìš´ë¡œë“œí•œë‹¤**.

```shell
# ìœ„ì¹˜ëŠ” C:/Users/ ì•ˆì˜ í™ˆ í´ë”
$ mkdir ~/.ssh/ # ~/.ssh í´ë”ê°€ ì—†ì„ ê²½ìš°
$ mv ~/Downloads/í‚¤ í˜ì–´ íŒŒì¼ëª….pem ~/.ssh/ # Downloadsì˜ í‚¤ í˜ì–´ë¥¼ .ssh/ë¡œ ì´ë™
$ ls ~/.ssh/ # í‚¤ í˜ì–´ê°€ ì˜ ì˜®ê²¨ì¡ŒëŠ”ì§€ í™•ì¸

$ chmod 400 ~/.ssh/í‚¤ í˜ì–´ íŒŒì¼ëª….pem # í‚¤ í˜ì–´ë¥¼ ì†Œìœ ì£¼ë§Œ ì½ì„ ìˆ˜ ìˆë„ë¡ ê¶Œí•œ ë³€ê²½
```



### 2.2. EC2 ì›ê²© ì ‘ì†í•˜ê¸°

```shell
$ ssh -i í‚¤ í˜ì–´ ê²½ë¡œ ìœ ì € ì´ë¦„@í¼ë¸”ë¦­ DNS ì£¼ì†Œ # í†µìƒì ìœ¼ë¡œ ìœ ì € ì´ë¦„ ê¸°ë³¸ê°’ì€ ubuntu # ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¤‘ì§€í–ˆë‹¤ê°€ ë‹¤ì‹œ ì‹œì‘í•˜ë©´ ì´ ì£¼ì†Œë„ 
```



### 2.3. EC2 ì„œë²„ ê¸°ë³¸ ì„¸íŒ…í•˜ê¸°

```shell
$ sudo apt-get update # íŒ¨í‚¤ì§€ ì •ë³´ ì—…ë°ì´íŠ¸
$ sudo apt-get dist-upgrade # íŒ¨í‚¤ì§€ ì˜ì¡´ì„± ê²€ì‚¬ ë° ì—…ê·¸ë ˆì´ë“œ
$ sudo apt-get install python3-pip # íŒŒì´ì¬3 ì„¤ì¹˜
$ sudo chown -R ubuntu:ubuntu /srv/ # git cloneí•  í´ë” ì†Œìœ ê¶Œ ë³€ê²½
$ cd /
$ ls -al # ì†Œìœ ê¶Œ ë³€ê²½ í™•ì¸
```



### 2.4. EC2 ì„œë²„ì— git clone í•˜ê¸°

```sh
$ cd /srv
$ git clone ì €ì¥ì†Œ ì£¼ì†Œ
$ ls # ì €ì¥ì†Œ cloneì´ ì œëŒ€ë¡œ ë˜ì—ˆëŠ”ì§€ í™•ì¸
```



### 2.5 ALLOWED_HOSTS ì£¼ì†Œ ì¶”ê°€í•˜ê³  runserver ì‹¤í–‰í•˜ê¸°

```shell
$ sudo apt-get install python3-venv # ê°€ìƒí™˜ê²½ ì„¤ì¹˜
$ cd ~
$ python3 -m venv ê°€ìƒí™˜ê²½ ì´ë¦„
$ source ê°€ìƒí™˜ê²½ ì´ë¦„/bin/activate # ê°€ìƒí™˜ê²½ í™œì„±í™”
$ cd /srv/í”„ë¡œì íŠ¸ ì´ë¦„/

$ pip3 install -r requirements.txt # requirements.txtì— ìˆëŠ” ëª¨ë“  íŒ¨í‚¤ì§€ ì„¤ì¹˜
```

ê·¸ëŸ¬ë‚˜ ìœ„ì—ì„œë„ ë§í–ˆë“¯ì´ requirements.txtë¥¼ ì´ìš©í•œ ì„¤ì¹˜ëŠ” ì•„ë˜ì™€ ê°™ì€ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì—¬ ë©ˆì¶œ ë•Œê°€ ë§ë‹¤. 

![ë°°í¬ ì¤‘ ì˜¤ë¥˜](https://user-images.githubusercontent.com/58945760/107650175-8b826a80-6cc1-11eb-83d4-28dc8fe06764.PNG)

íŠ¹íˆ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë²„ì „ì„ ë³„ë„ë¡œ ì…ë ¥í–ˆì„ ë•Œ ì´ëŸ¬í•œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê³¤ í•˜ëŠ”ë°, ì´ ë•ŒëŠ” ì›ê²© ì„œë²„ì— ë§ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì•Œì•„ì„œ ì„¤ì¹˜ë˜ë„ë¡ ë²„ì „ì„ ë”°ë¡œ í‘œê¸°í•˜ì§€ ì•ŠëŠ” ë°©ë²•ì„ ì“°ì§€ ì•Šìœ¼ë©´ ëœë‹¤.  

ë˜í•œ ì´ ì˜¤ë¥˜ ì™¸ì—ë„ error: invalid command 'bdist_wheel' ì—ëŸ¬ê°€ ë°œìƒí•˜ì—¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ë¥¼ ë°©í•´í•˜ëŠ”ë° ì´ ë•ŒëŠ” 

```shell
$ pip3 install wheel 
```

ì„ ì…ë ¥í•´ ì„¤ì¹˜í•´ì£¼ê³  ë‹¤ì‹œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•´ì£¼ë©´ ëœë‹¤.  requirements.txtë¡œ íŒ¨í‚¤ì§€ ì„¤ì¹˜ê°€ ë¶ˆê°€ëŠ¥í•  ê²½ìš° ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í•˜ë‚˜ í•˜ë‚˜ ì„¤ì¹˜í•˜ëŠ” ìˆ˜ë°–ì— ì—†ë‹¤. runserverë¥¼ í–ˆì„ ë•Œ ì—ëŸ¬ ë©”ì‹œì§€ì— No moduleì´ ë³´ì¸ë‹¤ë©´ ì¬ë¹ ë¥´ê²Œ í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•´ì£¼ì.

```shell
$ python3 manage.py runserver 0:8080
# ì ‘ì† ì£¼ì†Œ: http://í¼ë¸”ë¦­ DNS ì£¼ì†Œ:8080/
```

ì ‘ì†ì€ ë˜ì§€ë§Œ í˜ì´ì§€ëŠ” ë‚˜ì˜¤ì§€ ì•Šì„ ê²ƒì´ë‹¤. EC2 í™”ë©´ì—ì„œ ë³´ì•ˆ>ë³´ì•ˆê·¸ë£¹> ì¸ë°”ìš´ë“œ ê·œì¹™ í¸ì§‘ìœ¼ë¡œ ë“¤ì–´ê°€ í¬íŠ¸ ë²”ìœ„ê°€ 8080ì¸ ê·œì¹™ì„ ì¶”ê°€í•œë‹¤. 

ë‹¤ì‹œ ì ‘ì†í•´ë³´ë©´ DisallowedHost at /ì´ë¼ëŠ” ë©”ì‹œì§€ê°€ ëœ¬ë‹¤. settings.pyì—ì„œ í•´ë‹¹ ì£¼ì†Œì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ì£¼ì†Œë¥¼ ì¶”ê°€í•´ì£¼ì–´ì•¼ ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤. 

```
ALLOWED_HOST=[
	".ap-northeast-2.compute.amazonaws.com"
]
```

 ```shell
# ë¡œì»¬ ì €ì¥ì†Œì—ì„œ ì»¤ë°‹
$ git add .
$ git commit -m "allowed host update"
$ git push origin master

# ì›ê²© ì„œë²„ ì €ì¥ì†Œì—ì„œ pull
$ git pull origin master

# ë‹¤ì‹œ ì ‘ì† ì‹œë„
$ python3 manage.py runserver 0:8080
 ```



